<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon type=image/svg href=https://dm4p385.github.io/gbu-blog/ico/favicon.svg><title>Designing TOTP style QR Codes for Scale in Low Connectivity Environments - The good, the bad, and the [undefined]</title><meta name=description content="A blog about tech, engineering and all things in between."><meta name=keywords content="TOTP,engineering,"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://dm4p385.github.io/gbu-blog/css/main.css><link rel=stylesheet type=text/css media=screen href=https://dm4p385.github.io/gbu-blog/css/syntax.css><script src=https://unpkg.com/feather-icons></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Designing TOTP style QR Codes for Scale in Low Connectivity Environments"><meta name=twitter:description content="By converting QR codes into time-synced tokens (like Google Auth), we cut server load, minimized retries, and made our fest app work flawlessly offline-first."><meta property="og:url" content="https://dm4p385.github.io/gbu-blog/posts/totp-based-qr/"><meta property="og:site_name" content="The good, the bad, and the [undefined]"><meta property="og:title" content="Designing TOTP style QR Codes for Scale in Low Connectivity Environments"><meta property="og:description" content="By converting QR codes into time-synced tokens (like Google Auth), we cut server load, minimized retries, and made our fest app work flawlessly offline-first."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-23T12:00:00+05:30"><meta property="article:modified_time" content="2025-10-23T12:00:00+05:30"><meta property="article:tag" content="TOTP"><meta property="article:tag" content="Engineering"><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("consent","default",{ad_storage:"denied",analytics_storage:"denied"})</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-XXXXXXXXX-X")</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX-X"></script><script>for(var c,nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++)c=ca[i],c.includes(nameEQ)&&gtag("consent","update",{ad_storage:"denied",analytics_storage:"granted"})</script></head><body><div class=container><header><div><h1 class=site-title><a href=https://dm4p385.github.io/gbu-blog/><span class=title-prefix>The good, the bad, and the </span><span class="bracket open">[</span><span class=undefined-inner>undefined</span><span class="bracket close">]</span></a></h1><div class=site-info><h2>A blog about tech, engineering and all things in between.</h2><nav class=social-nav><ul class=flat><li><a href=https://github.com/dm4p385 title=GitHub target=_blank><i data-feather=github></i></a></li><li><a href=https://x.com/harsh_singh58 title=X target=_blank><i data-feather=twitter></i></a></li><li><a href=https://www.linkedin.com/in/harshsingh58 title=LinkedIn target=_blank><i data-feather=linkedin></i></a></li><li><a rel=alternate type=application/rss+xml href=https://dm4p385.github.io/gbu-blog/index.xml title="The good, the bad, and the [undefined]"><i data-feather=rss></i></a></li></ul></nav></div><nav><ul class=flat><li><a href=/gbu-blog/>Home</a></li><li><a href=/gbu-blog/posts>Posts</a></li><li><a href=/gbu-blog/tags>Tags</a></li><li><a href=/gbu-blog/about>About</a></li></ul></nav></div></header><div class=content><div><h1 class=single-title>Designing TOTP style QR Codes for Scale in Low Connectivity Environments</h1><p class=metadata>Published - 2025-10-23 | <i data-feather=clock style=width:12px;height:12px></i> 4min</p></div><article class=markdown><h2 id=background><strong>Background</strong></h2><p>During college, I was part of a club responsible for building the apps and websites used during BITS Pilani’s cultural and tech fests. These fests are massive multi-day events packed with competitions,´ concerts, food stalls, thousands of participants, and a chaotic influx of people entering and exiting the campus. Managing the end-to-end participant lifecycle without tech would have been a logistical nightmare.</p><p>So we turned everything into a digital flow:</p><ul><li>Event registration → scan your fest app QR</li><li>Food stalls → order digitally, pick up using OTP</li><li>Concert entry → scan & go</li><li>Payments, tracking, validation → all digitized and handled by software</li></ul><p>If there existed a logistical bottleneck, we tried to solve it with software.</p><p>But while building features is easy, building them to scale under hostile constraints (like terrible internet) is a whole different challenge.</p><hr><h2 id=the-problem>The Problem</h2><p>Each user had a QR code tied to their profile. Scanning this QR allowed us to identify them for registration, food orders, or concert entry. Simple, right?</p><p>Except… if someone got hold of your QR, they could:</p><ul><li>Register you into paid events</li><li>Use up your concert tickets</li></ul><p>To prevent these kinds of attacks, we needed <em>time-bound</em> QR codes which had to expire periodically and be re-fetched from the server.</p><p>This introduced a new bottleneck: <strong>QRs were being refreshed far too frequently, and every scan required server validation.</strong></p><p>And then came the worst part: <strong>concert zones had horrible internet.</strong></p><p>Requests were slow, retries were frequent, and collectively 4000+ attendees aggressively refreshing their QR screens choked the already weak bandwidth.</p><p>We weren’t dealing with just <em>load,</em> we were dealing with <strong>load + retries + terrible latency + bandwidth constraints</strong>.</p><hr><h2 id=the-scale-rough-guesstimates><strong>The Scale (Rough Guesstimates)</strong></h2><p>Assuming a retry factor of ~3 per request due to poor connectivity:</p><table><thead><tr><th>Action</th><th>Users</th><th>Retries</th><th>Total Requests</th></tr></thead><tbody><tr><td>QR fetch</td><td>4000</td><td>×3</td><td>~12,000</td></tr><tr><td>QR scans</td><td>4000</td><td>×2</td><td>~8,000</td></tr><tr><td><strong>Total</strong></td><td></td><td></td><td>~20,000</td></tr></tbody></table><p>Spread over 1–2 hours = 3–6 req/sec on average.</p><p>But peak bursts (during panic refreshes) likely hit 20–50 req/sec under poor network conditions.</p><p>All of this… on a connection that could barely load a 4K YouTube video.</p><hr><h2 id=constraints><strong>Constraints</strong></h2><p>We needed a solution that:</p><ul><li>Drastically reduced client-server communication</li><li>Still enforced expiry & security</li><li>Worked even under flaky/no internet</li></ul><hr><h2 id=the-aha-moment><strong>The “Aha!” Moment</strong></h2><p>I asked myself: <em>“Where have I seen a system that refreshes every 30s, works offline, and still stays secure?”</em></p><p>And then it hit me: <strong>Google Authenticator already implements this!</strong></p><p>How does it generate valid OTPs without any network communication?</p><p>It uses a <strong>pre-shared secret key + time-based hashing (TOTP)</strong>.</p><p>From a Reddit explanation I found:</p><blockquote><p>Using a shared secret and a current timestamp (rounded to 30-second windows), both client and server independently generate the same hash. Because time is shared, they remain in sync, even offline.</p></blockquote><p>Example:</p><p>If timestamp = <code>1505480619</code> and secret key = <code>1234</code>,</p><p>Then <code>hash(timestamp * key) → last 4 digits = OTP</code>.</p><p>After 30 seconds, a new OTP appears, but still matches on server side.</p><p><em>No network calls. No refresh requests. No bandwidth load.</em></p><hr><h3 id=the-new-architecture><strong>The New Architecture</strong></h3><table><thead><tr><th>Before (Old Flow)</th><th>After (New Flow Inspired by TOTP)</th></tr></thead><tbody><tr><td>QR expired → app hits server frequently</td><td>App locally generates QR (based on time + secret)</td></tr><tr><td>Every scan → server validates</td><td>On scan → single server validation</td></tr><tr><td>Bandwidth-heavy</td><td>Near-zero bandwidth except final validation</td></tr></tbody></table><p>So the solution was simple, upon login we will generate a private key on the backend and share it with the app so both the parties had one piece of the puzzle.</p><p>Both client and server used this shared secret to generate a time-bound QR code.</p><p>Even if internet was slow or unavailable, the QR always appeared in time.</p><div style="display:flex;gap:1rem;flex-wrap:wrap;margin:1rem 0"><figure style="flex:1 1 48%;margin:0"><img src=images/p1_old_flow.png alt="The Old Flow" style=width:100%;height:auto;border-radius:8px;object-fit:cover><figcaption style=font-size:.9rem;color:var(--muted,#666);margin-top:.4rem>Old flow: server-heavy QR refresh</figcaption></figure><figure style="flex:1 1 48%;margin:0"><img src=images/p1_new_flow.png alt="The New Flow" style=width:100%;height:auto;border-radius:8px;object-fit:cover><figcaption style=font-size:.9rem;color:var(--muted,#666);margin-top:.4rem>New flow: time-synced QR generated locally</figcaption></figure></div><hr><h3 id=what-happened-next><strong>What Happened Next</strong></h3><p>We implemented this approach just <strong>3 days before launch</strong>.</p><p>Had a few timestamp mismatches? Yes.</p><p>Expanded verification window to T-1 to T+1 minutes? Fixed.</p><p>Launched under stress? Absolutely.</p><ul><li>On concert day, QR codes loaded <em>instantly</em>.</li><li>Entry lines moved faster than ever.</li><li>Nobody complained about network issues.</li><li>We even got live praise on our campus’ social media circles for how smooth the experience was.</li></ul><hr><h3 id=conclusion><strong>Conclusion</strong></h3><p>Sometimes, solving a scaling issue isn’t about adding more servers or throwing infra at the problem, it’s about rethinking the system itself.</p><p>In the end we were able to</p><ul><li>Minimize network usage by reducing the throughput.</li><li>Preserved security by still retaining the expiry feature.</li><li>Implemented all of this within just 3 days of the app launch!</li><li>Handle ticketing worth 7.6 million INR without a hitch</li><li>But most importantly… won user trust ♥️</li></ul><p>At the end of the day, what sets great engineering apart is the ability to <em>build → execute → iterate</em> with clarity and purpose even when the clock is ticking. This is something that I was able to achieve a lot of times working for this club and is probably the reason why I fell in love with software engineering in the first place.</p></article><div class=post-tags><nav class=tags><ul class=flat><li><a href=/tags/totp>TOTP</a></li><li><a href=/tags/engineering>engineering</a></li></ul></nav></div><div><style>#share-buttons{display:inline-block;vertical-align:middle}#share-buttons:after{content:"";display:block;clear:both}#share-buttons>div{position:relative;text-align:left;height:36px;width:32px;float:left;text-align:center}#share-buttons>div>svg{height:16px;fill:#ebdbb2;margin-top:10px}#share-buttons>div:hover{cursor:pointer}#share-buttons>div.facebook:hover>svg{fill:#3b5998}#share-buttons>div.twitter:hover>svg{fill:#55acee}#share-buttons>div.linkedin:hover>svg{fill:#0077b5}#share-buttons>div.pinterest:hover>svg{fill:#cb2027}#share-buttons>div.gplus:hover>svg{fill:#dd4b39}#share-buttons>div.mail:hover>svg{fill:#7d7d7d}#share-buttons>div.instagram:hover>svg{fill:#c73b92}#share-buttons>div.facebook>svg{height:18px;margin-top:9px}#share-buttons>div.twitter>svg{height:20px;margin-top:8px}#share-buttons>div.linkedin>svg{height:19px;margin-top:7px}#share-buttons>div.pinterest>svg{height:20px;margin-top:9px}#share-buttons>div.gplus>svg{height:17px;margin-top:9px;position:relative;left:1px}#share-buttons>div.mail>svg{height:14px;margin-top:11px}</style><span style=color:#ebdbb2>Share on:</span><div id=share-buttons><div class=facebook title="Share this on Facebook" onclick='window.open("http://www.facebook.com/share.php?u=https://dm4p385.github.io/gbu-blog/posts/totp-based-qr/")'><svg viewBox="0 0 1792 1792"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"/></svg></div><div class=twitter title="Share this on Twitter" onclick='window.open("https://twitter.com/intent/tweet?url=https://dm4p385.github.io/gbu-blog/posts/totp-based-qr/")'><svg viewBox="0 0 1792 1792"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div><div class=linkedin title="Share this on Linkedin" onclick='window.open("https://www.linkedin.com/shareArticle?mini=true&url=https://dm4p385.github.io/gbu-blog/posts/totp-based-qr/&title=&summary=&source=")'><svg viewBox="0 0 1792 1792"><path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"/></svg></div><div class=mail title="Share this through Email" onclick='window.open("mailto:?&body=https://dm4p385.github.io/gbu-blog/posts/totp-based-qr/")'><svg viewBox="0 0 1792 1792"><path d="M1792 710v794q0 66-47 113t-113 47H160q-66 0-113-47T0 1504V710q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 1e2-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38T639 1015q-91-64-262-182.5T172 690q-62-42-117-115.5T0 438q0-78 41.5-130T160 256h1472q65 0 112.5 47t47.5 113z"/></svg></div></div></div><style>.relatedcontainer{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-evenly;align-items:stretch;margin-top:0}.relateditem{display:block;color:var(--fg);max-width:30%;padding:2%;height:auto;margin:2%;box-shadow:0 .4rem .8rem rgba(0,0,0,.5);transition:.3s;border-radius:.5rem}.relateditem:hover{background-color:var(--bg1);color:var(--fg)}.relateditem p{text-overflow:ellipsis;margin:.5rem}.relateditem h6{font-size:1.2rem;margin:.5rem;color:var(--red)}.related{border-top:1px dashed var(--fg);margin-top:2rem}.related h5{font-size:1.6rem;margin-bottom:1rem;margin-top:1rem}@media only screen and (max-width:640px){.relateditem{min-width:60%}}@media only screen and (max-device-width:640px){.relateditem{min-width:60%}}</style></div><footer><nav><ul class=flat><li><div id=copyright>© 2025 Harsh Singh</div></li><li>[Built with <a href=https://gohugo.io>Hugo</a>]</li></ul></nav><script>feather.replace()</script></footer></div></body></html>